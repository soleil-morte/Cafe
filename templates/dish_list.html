{% extends "base.html" %}

{% block title %}–ú–µ–Ω—é - –ö–∞—Ñ–µ –£—é—Ç–Ω–æ–µ{% endblock %}

{% block content %}
<div class="container">
    {% if request.user.is_administrator or request.user.is_manager or request.user.is_chef or request.user.is_cook %}
    <div class="page-header">
        <h1>üçΩÔ∏è –ù–∞—à–µ –º–µ–Ω—é</h1>
        <a href="/menu/add/" class="btn primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ</a>


    </div>
    {% else %}
    <div class="page-header">
        <h1>üçΩÔ∏è –ù–∞—à–µ –º–µ–Ω—é</h1>
    </div>
    {% endif %}

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ -->
    {% if global_availability and not global_availability.all_available %}
    <div class="global-warning">
        ‚ö†Ô∏è <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –ï—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É –±–ª—é–¥–∞–º–∏:
        {{ global_availability.conflicting_dishes|join:", " }}
    </div>
    {% endif %}

    <div class="dishes-grid">
        {% for dish in dishes %}
        <div class="dish-card">
            {% if dish.image %}
            <div class="dish-image">
                <img src="{{ dish.image.url }}" alt="{{ dish.name }}" class="img-fixed">
            </div>
            {% else %}
            <div class="dish-image no-image">
                üçΩÔ∏è
            </div>
            {% endif %}

            <div class="dish-info">
                <h3>{{ dish.name }}</h3>
                <p class="price">{{ dish.price }} —Å—É–º</p>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Ä—Ü–∏—è—Ö -->
                <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                    <div><strong>–î–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Ä—Ü–∏–π: {{ dish.portions }}</strong></div>

                    <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        <strong>–ù–∞ 1 –ø–æ—Ä—Ü–∏—é –Ω—É–∂–Ω–æ:</strong>
                        {% for ingredient in dish.ingredients.all %}
                        <div>{{ ingredient.product.name }}: {{ ingredient.quantity }} {{ ingredient.get_unit_display }}
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ä—Ü–∏–π -->
                {% if request.user.is_cook or request.user.is_chef or request.user.is_administrator %}
                <form method="post" action="{% url 'add_portions' dish.id %}">
                    {% csrf_token %}
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" name="portions" value="1" min="1"
                            style="width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <button type="submit" class="btn btn-sm" style="padding: 8px 15px;">
                            üç≥ –ü—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ—Ä—Ü–∏–∏
                        </button>
                    </div>
                    <small style="color: #666;">–ü—Ä–æ–¥—É–∫—Ç—ã —Å–ø–∏—à—É—Ç—Å—è —Å–æ —Å–∫–ª–∞–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</small>
                </form>
                {% endif %}
            </div>

            <div class="card-actions">
                <a href="/menu/{{ dish.id }}/" class="btn btn-sm">üëÅÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                {% if request.user.is_administrator or request.user.is_manager or request.user.is_chef or  request.user.is_cook %}
                <a href="/menu/{{ dish.id }}/edit/" class="btn btn-sm">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</a>
                <a href="/menu/{{ dish.id }}/delete/" class="btn btn-sm danger"
                    onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –±–ª—é–¥–æ {{ dish.name }}?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div class="empty-state">
            <p>üçΩÔ∏è –ü–æ–∫–∞ –Ω–µ—Ç –±–ª—é–¥ –≤ –º–µ–Ω—é</p>
            {% if request.user.is_administrator or request.user.is_manager or request.user.is_chef or request.user.is_cook %}
            <a href="/menu/add/" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ –±–ª—é–¥–æ</a>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}