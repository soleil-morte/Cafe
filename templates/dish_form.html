{% extends 'base.html' %}

{% block title %}{{ title }} - Restaurant Pro{% endblock %}
{% block page_title %}{{ title }}{% endblock %}

{% block content %}
<div style="max-width: 800px; background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <h3 style="margin-bottom: 20px;">Taom ma'lumotlari</h3>
        
        {% for field in dish_form %}
        <div class="form-group">
            <label class="form-label">{{ field.label }}</label>
            {{ field }}
            {% if field.errors %}
            <div style="color: var(--danger); font-size: 0.9rem; margin-top: 5px;">
                {{ field.errors }}
            </div>
            {% endif %}
        </div>
        {% endfor %}
        
        <h3 style="margin: 30px 0 20px 0;">Masalliqlar</h3>
        
        {{ formset.management_form }}
        <div id="ingredients-formset">
            {% for form in formset %}
            <div class="ingredient-form" style="border: 1px solid #eee; padding: 15px; margin-bottom: 15px; border-radius: var(--border-radius);">
                {% for hidden in form.hidden_fields %}
                    {{ hidden }}
                {% endfor %}
                
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px; align-items: end;">
                    {% for field in form.visible_fields %}
                    <div class="form-group">
                        <label class="form-label">{{ field.label }}</label>
                        {{ field }}
                    </div>
                    {% endfor %}
                    
                    {% if form.instance.pk and formset.can_delete %}
                    <div class="form-group">
                        <label class="form-label">O'chirish</label>
                        {{ form.DELETE }}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <button type="button" id="add-ingredient" class="btn" style="background: var(--light); color: var(--dark); margin-bottom: 20px;">
            + Yangi masalliq qo'shish
        </button>
        
        <div style="display: flex; gap: 10px;">
            <button type="submit" class="btn btn-primary">Saqlash</button>
            <a href="{% url 'menu' %}" class="btn" style="background: var(--light); color: var(--dark);">Bekor qilish</a>
        </div>
    </form>
</div>

<script>
document.getElementById('add-ingredient').addEventListener('click', function() {
    const formset = document.getElementById('ingredients-formset');
    const totalForms = document.getElementById('id_form-TOTAL_FORMS');
    const formCount = parseInt(totalForms.value);
    
    const newForm = document.querySelector('.ingredient-form').cloneNode(true);
    newForm.innerHTML = newForm.innerHTML.replace(/form-0/g, `form-${formCount}`);
    newForm.innerHTML = newForm.innerHTML.replace(/form-0/g, `form-${formCount}`);
    
    // Clear input values
    newForm.querySelectorAll('input').forEach(input => {
        if (input.type !== 'hidden') {
            input.value = '';
        }
    });
    
    formset.appendChild(newForm);
    totalForms.value = formCount + 1;
});
</script>
{% endblock %}